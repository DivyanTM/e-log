<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>ELOG</title>
    <!-- plugins:css -->
    <link rel="stylesheet" href="assets/vendors/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="assets/vendors/css/vendor.bundle.base.css">
    <!-- endinject -->
    <!-- Plugin css for this page -->
    <link rel="stylesheet" href="assets/vendors/jvectormap/jquery-jvectormap.css">
    <link rel="stylesheet" href="assets/vendors/flag-icon-css/css/flag-icon.min.css">
    <link rel="stylesheet" href="assets/vendors/owl-carousel-2/owl.carousel.min.css">
    <link rel="stylesheet" href="assets/vendors/owl-carousel-2/owl.theme.default.min.css">
    <!-- End plugin css for this page -->
    <!-- inject:css -->
    <!-- endinject -->
    <!-- Layout styles -->
    <link rel="stylesheet" href="assets/css/style.css">
    <!-- End layout styles -->
    <!-- <link rel="shortcut icon" href="assets/images/favicon.png" /> -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community@latest/styles/ag-theme-quartz-dark.css">
    <script src="https://cdn.jsdelivr.net/npm/ag-grid-community@latest/dist/ag-grid-community.min.js"></script>
    


    
  </head>
  <body>
    <div class="container-scroller">
      <!-- partial:partials/_sidebar.html -->
      <nav class="sidebar sidebar-offcanvas" id="sidebar">
        <div class="sidebar-brand-wrapper d-none d-lg-flex align-items-center justify-content-center fixed-top">
          <a class="sidebar-brand text-decoration-none text-white d-flex align-items-center gap-2" href="CEDashboard.html">
            <span class="mdi mdi-database fs-6 text-success" style="font-size: 2rem !important;"></span>
            <span class="fs-6">ELOG</span>
          </a>
        </div>
        
        <ul class="nav">
            <!-- <li class="nav-item profile">
                <div class="profile-desc">
                  <div class="profile-pic">
                    <div class="count-indicator">
                      <img class="img-xs rounded-circle " src="assets/images/faces/face15.jpg" alt="">
                      <span class="count bg-success"></span>
                    </div>
                    <div class="profile-name">
                      <h5 class="mb-0 font-weight-normal">Henry Klein</h5>
                      <span>Gold Member</span>
                    </div>
                  </div>
                  <a href="#" id="profile-dropdown" data-toggle="dropdown"><i class="mdi mdi-dots-vertical"></i></a>
                  <div class="dropdown-menu dropdown-menu-right sidebar-dropdown preview-list" aria-labelledby="profile-dropdown">
                    <a href="#" class="dropdown-item preview-item">
                      <div class="preview-thumbnail">
                        <div class="preview-icon bg-dark rounded-circle">
                          <i class="mdi mdi-settings text-primary"></i>
                        </div>
                      </div>
                      <div class="preview-item-content">
                        <p class="preview-subject ellipsis mb-1 text-small">Account settings</p>
                      </div>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#" class="dropdown-item preview-item">
                      <div class="preview-thumbnail">
                        <div class="preview-icon bg-dark rounded-circle">
                          <i class="mdi mdi-onepassword  text-info"></i>
                        </div>
                      </div>
                      <div class="preview-item-content">
                        <p class="preview-subject ellipsis mb-1 text-small">Change Password</p>
                      </div>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#" class="dropdown-item preview-item">
                      <div class="preview-thumbnail">
                        <div class="preview-icon bg-dark rounded-circle">
                          <i class="mdi mdi-calendar-today text-success"></i>
                        </div>
                      </div>
                      <div class="preview-item-content">
                        <p class="preview-subject ellipsis mb-1 text-small">To-do list</p>
                      </div>
                    </a>
                  </div>
                </div>
              </li> -->
            <!-- <li class="nav-item nav-category">
                <span class="nav-link">Navigation</span>
              </li> -->
            <li class="nav-item menu-items">
              <a class="nav-link" href="CEDashboard.html">
                <span class="menu-icon">
                  <i class="mdi mdi-speedometer text-gray"></i>
                </span>
                <span class="menu-title">Dashboard</span>
              </a>
            </li>
            <li class="nav-item menu-items">
              <a class="nav-link" data-toggle="collapse" href="#ui-basic" aria-expanded="false" aria-controls="ui-basic">
                <span class="menu-icon">
                  <i class="mdi mdi-book-multiple text-gray"></i>
                </span>
                <span class="menu-title">Record Books</span>
                <i class="menu-arrow"></i>
              </a>
              <div class="collapse" id="ui-basic">
                <ul class="nav flex-column sub-menu">
                  <!-- ORB1 and ORB2 -->
                  <!-- <li class="nav-item">
                      <a class="nav-link" href="orb1.html" style="font-size: 16px;">
                          <i class="mdi mdi-oil text-gray" style="font-size: 20px; margin-right: 8px;"></i>
                          ORB-I
                      </a>
                  </li> -->
                  <!-- <li class="nav-item">
                      <a class="nav-link" href="orb2.html" style="font-size: 16px;">
                          <i class="mdi mdi-fuel text-gray" style="font-size: 20px; margin-right: 8px;"></i>
                          ORB-II
                      </a>
                  </li> -->
              
                  <!-- GRB -->
                  <li class="nav-item">
                      <a class="nav-link" href="grbRecords.html" style="font-size: 16px;">
                          <i class="mdi mdi-trash-can text-gray" style="font-size: 20px; margin-right: 8px;"></i>
                          Garbage RB
                      </a>
                  </li>
              
                  <!-- CRB -->
                  <!-- <li class="nav-item">
                      <a class="nav-link" href="crb.html" style="font-size: 16px;">
                          <i class="mdi mdi-clipboard-text text-gray" style="font-size: 20px; margin-right: 8px;"></i>
                          Cargo RB
                      </a>
                  </li>
               -->
                  <!-- APR B (NOX Tier Changeover) -->
                  <!-- <li class="nav-item">
                      <a class="nav-link" href="aprb.html" style="font-size: 16px;">
                          <i class="mdi mdi-swap-horizontal text-gray" style="font-size: 20px; margin-right: 8px;"></i>
                          NOX Change
                      </a>
                  </li> -->
              
                  <!-- BDR (Bunker Delivery) -->
                  <!-- <li class="nav-item">
                      <a class="nav-link" href="bdr.html" style="font-size: 16px;">
                          <i class="mdi mdi-gas-station text-gray" style="font-size: 20px; margin-right: 8px;"></i>
                          Bunker Deliv
                      </a>
                  </li> -->
              
                  <!-- BWRB (Ballast Water Record Book) -->
                  <!-- <li class="nav-item">
                      <a class="nav-link" href="bwrb.html" style="font-size: 16px;">
                          <i class="mdi mdi-ferry text-gray" style="font-size: 20px; margin-right: 8px;"></i>
                          Ballast WB
                      </a>
                  </li> -->
              
                  <!-- FOR (Fuel Oil Received Record Book) -->
                  <li class="nav-item">
                      <a class="nav-link" href="forRecords.html" style="font-size: 16px;">
                          <i class="mdi mdi-call-received text-gray" style="font-size: 20px; margin-right: 8px;"></i>
                          Fuel Received
                      </a>
                  </li>
              
                  <!-- FOS (Fuel Oil Sample Control and Tracking) -->
                  <li class="nav-item">
                      <a class="nav-link" href="fosRecords.html" style="font-size: 16px;">
                          <i class="mdi mdi-flask text-gray" style="font-size: 20px; margin-right: 8px;"></i>
                          Fuel Sample
                      </a>
                  </li>
              
                  <!-- LSFCO (Low Sulphur Fuel Change Over) -->
                  <!-- <li class="nav-item">
                      <a class="nav-link" href="lsfco.html" style="font-size: 16px;">
                          <i class="mdi mdi-leaf text-gray" style="font-size: 20px; margin-right: 8px;"></i>
                          LSFO Change
                      </a>
                  </li> -->
              
                  <!-- ODSRB (Ozone Depleting Substance Record Book) -->
                  <!-- <li class="nav-item">
                      <a class="nav-link" href="odsrb.html" style="font-size: 16px;">
                          <i class="mdi mdi-earth text-gray" style="font-size: 20px; margin-right: 8px;"></i>
                          ODS RB
                      </a>
                  </li> -->
              </ul>
    
    
    
              </div>
            </li>
            <!-- <li class="nav-item menu-items">
              <a class="nav-link" data-toggle="collapse" href="#logs" aria-expanded="false" aria-controls="ui-basic">
                <span class="menu-icon">
                  <i class="mdi mdi mdi-history text-gray"></i>
                </span>
                <span class="menu-title">Logs</span>
                <i class="menu-arrow"></i>
              </a>
              <div class="collapse" id="logs">
                <ul class="nav flex-column sub-menu">
               
                  <li class="nav-item">
                      <a class="nav-link" href="orb1.html" style="font-size: 16px;">
                          <i class="mdi mdi-oil text-gray" style="font-size: 20px; margin-right: 8px;"></i>
                          ORB-I
                      </a>
                  </li>
                  <li class="nav-item">
                      <a class="nav-link" href="orb2.html" style="font-size: 16px;">
                          <i class="mdi mdi-fuel text-gray" style="font-size: 20px; margin-right: 8px;"></i>
                          ORB-II
                      </a>
                  </li>
              
              
                  <li class="nav-item">
                      <a class="nav-link" href="grb.html" style="font-size: 16px;">
                          <i class="mdi mdi-trash-can text-gray" style="font-size: 20px; margin-right: 8px;"></i>
                          Garbage RB
                      </a>
                  </li>
              
                  
                  <li class="nav-item">
                      <a class="nav-link" href="crb.html" style="font-size: 16px;">
                          <i class="mdi mdi-clipboard-text text-gray" style="font-size: 20px; margin-right: 8px;"></i>
                          Cargo RB
                      </a>
                  </li>
              
                 
                  <li class="nav-item">
                      <a class="nav-link" href="aprb.html" style="font-size: 16px;">
                          <i class="mdi mdi-swap-horizontal text-gray" style="font-size: 20px; margin-right: 8px;"></i>
                          NOX Change
                      </a>
                  </li>
              
                  
                  <li class="nav-item">
                      <a class="nav-link" href="bdr.html" style="font-size: 16px;">
                          <i class="mdi mdi-gas-station text-gray" style="font-size: 20px; margin-right: 8px;"></i>
                          Bunker Deliv
                      </a>
                  </li>
              
                  
                  <li class="nav-item">
                      <a class="nav-link" href="bwrb.html" style="font-size: 16px;">
                          <i class="mdi mdi-ferry text-gray" style="font-size: 20px; margin-right: 8px;"></i>
                          Ballast WB
                      </a>
                  </li>
              
                 
                  <li class="nav-item">
                      <a class="nav-link" href="for.html" style="font-size: 16px;">
                          <i class="mdi mdi-call-received text-gray" style="font-size: 20px; margin-right: 8px;"></i>
                          Fuel Received
                      </a>
                  </li>
              
                  
                  <li class="nav-item">
                      <a class="nav-link" href="records.html" style="font-size: 16px;">
                          <i class="mdi mdi-flask text-gray" style="font-size: 20px; margin-right: 8px;"></i>
                          Fuel Sample
                      </a>
                  </li>
              
                
                  <li class="nav-item">
                      <a class="nav-link" href="lsfco.html" style="font-size: 16px;">
                          <i class="mdi mdi-leaf text-gray" style="font-size: 20px; margin-right: 8px;"></i>
                          LSFO Change
                      </a>
                  </li>
              
                  
                  <li class="nav-item">
                      <a class="nav-link" href="odsrb.html" style="font-size: 16px;">
                          <i class="mdi mdi-earth text-gray" style="font-size: 20px; margin-right: 8px;"></i>
                          ODS RB
                      </a>
                  </li>
              </ul>
    
    
    
              </div>
            </li> -->
            <li class="nav-item menu-items">
              <a class="nav-link" href="auditTrail.html">
                <span class="menu-icon">
                  <i class="mdi mdi-history text-gray"></i>
                </span>
                <span class="menu-title">Audit Logs</span>
              </a>
            </li>
            <li class="nav-item menu-items active-link">
              <a class="nav-link" href="verifyRecords.html">
                <span class="menu-icon">
                  <i class="mdi mdi-check-circle-outline text-gray"></i>
                </span>
                <span class="menu-title">Verify Records</span>
              </a>
            </li>
            <li class="nav-item menu-items">
              <a class="nav-link" href="verifiedRecords.html">
                <span class="menu-icon">
                  <i class="mdi mdi-progress-check text-gray"></i>
                </span>
                <span class="menu-title">Verified Records</span>
              </a>
            </li>
          </ul>
      </nav>
      <!-- partial -->
      <div class="container-fluid page-body-wrapper">
        <!-- partial:partials/_navbar.html -->
        <nav class="navbar p-0 fixed-top d-flex flex-row">
          <div class="navbar-brand-wrapper d-flex d-lg-none align-items-center justify-content-center">
            <span class="mdi mdi-database fs-6 text-success" style="font-size: 2rem !important;"></span>
          </div>
          <div class="navbar-menu-wrapper flex-grow d-flex align-items-stretch">
            <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
              <span class="mdi mdi-menu"></span>
            </button>
            
          </div>
        </nav>
        <!-- partial -->
        <div class="main-panel">
          <div class="content-wrapper">
            <div class="row mb-3">
              <div class="col-md-12 d-flex align-items-center justify-content-end ">
                <div class="dropdown m-1">
                    <button class="bg-card px-3 py-2 shadow-lg rounded-pill border d-flex align-items-center dropdown-toggle"
                            type="button" id="recordBookDropdown1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <p class="p-0 m-0">Record Book</p>
                    </button>
                    <div class="dropdown-menu" aria-labelledby="recordBookDropdown1" id="recordBookDropdown">
                        <!-- <li class="dropdown-item text-white" style="cursor: pointer;" >Fuel Oil Sample Record</li>
                        <li class="dropdown-item text-white" style="cursor: pointer;">Fuel Oil Received Record</l>
                        <li class="dropdown-item text-white" style="cursor: pointer;">Garbage Record Book</li> -->
                    </div>
                </div>
            
                <div class="dropdown m-1">
                    <button class="bg-card px-3 py-2 shadow-lg rounded-pill border d-flex align-items-center dropdown-toggle"
                            type="button" id="timeDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <p class="p-0 m-0">Time</p>
                    </button>
                    <div class="dropdown-menu" aria-labelledby="timeDropdown">
                        <li class="dropdown-item text-white" id="sortByAsc" style="cursor: pointer;">Ascending</l>
                        <li class="dropdown-item text-white" id="sortByDesc" style="cursor: pointer;">Descending</l>
                    </div>
                </div>
            
                <div class="dropdown m-1">
                    <button class="bg-card px-3 py-2 shadow-lg rounded-pill border d-flex align-items-center dropdown-toggle"
                            type="button"  data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <p class="p-0 m-0">User</p>
                    </button>
                    <div class="dropdown-menu" aria-labelledby="userDropdown" id="userDropdown">
                        <!-- <a class="dropdown-item" href="#">User 1</a>
                        <a class="dropdown-item" href="#">User 2</a> -->
                    </div>
                </div>
            
                <div class="input-group m-1 border bg-card rounded-pill px-3" style="width: 200px;">
                  <div class="input-group-append">
                    <span class="input-group-text bg-card border-0">
                        <i class="mdi mdi-magnify text-muted"></i>
                    </span>
                </div>
                  <input type="text" class="form-control bg-card border-0 rounded-pill px-2" id="search" placeholder="Search..." aria-label="Search">
                  
              </div>
              
            </div>
            
            
            </div>
           
          <ul class="list-unstyled" id="records" >
          
          </ul>
        
          <div class="modal fade" id="fuelOilModal" tabindex="-1" aria-labelledby="fuelOilModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content bg-card shadow-lg">
                    <div class="card-header bg-info  d-flex justify-content-between align-items-center">
                        <h5 class="modal-title mb-0 " id="fuelOilModalLabel">Fuel Oil Sample Received - Record No: 3</h5>
                        <button type="button" class="close text-gray" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="p-5">
                        <table class="table table-bordered font-weight-lighter text-white" id="recordModal">
                            <tbody>

                            </tbody>
                        </table>
        
                        <div id="rejectRemarks" class="mt-3 d-none">
                            <label for="remarks" class="form-label">Rejection Remarks:</label>
                            <textarea id="remarks" class="form-control border rounded" placeholder="Enter rejection remarks" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="card-footer d-flex justify-content-end">
                        <button type="button" class="btn btn-success mr-2" id="approveBtn" data-dismiss="modal" data-target="#fuelOilModal">
                            <i class="mdi mdi-check"></i> Approve
                        </button>
                        <button type="button" class="btn btn-danger mr-2" id="rejectBtn">
                            <i class="mdi mdi-close"></i> Reject
                        </button>
                        <button type="button" class="btn btn-secondary" id="closeBtn" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        



          <!-- content-wrapper ends -->
          <!-- partial:partials/_footer.html -->
          <footer class="footer">
          
          </footer>
          <!-- partial -->
        </div>
        <!-- main-panel ends -->
      </div>
      <!-- page-body-wrapper ends -->
    </div>
    <!-- container-scroller -->
    <!-- plugins:js -->
    <script src="assets/vendors/js/vendor.bundle.base.js"></script>


   
    <!-- endinject -->
    <!-- Plugin js for this page -->
    <script src="assets/vendors/chart.js/Chart.min.js"></script>
    <script src="assets/vendors/progressbar.js/progressbar.min.js"></script>
    <script src="assets/vendors/jvectormap/jquery-jvectormap.min.js"></script>
    <script src="assets/vendors/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
    <script src="assets/vendors/owl-carousel-2/owl.carousel.min.js"></script>
    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <script src="assets/js/off-canvas.js"></script>
    <script src="assets/js/hoverable-collapse.js"></script>
    <script src="assets/js/misc.js"></script>
    <script src="assets/js/settings.js"></script>
    <script src="assets/js/todolist.js"></script>
    <!-- endinject -->
    <!-- Custom js for this page -->


  <!-- api -->
  <script src="assets/js/apiRequest.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="assets/js/axiosInstance.js"></script>

    <script src="assets/js/dashboard.js"></script>

    <script>
     document.getElementById("rejectBtn").addEventListener("click", function () {
    document.getElementById("rejectRemarks").classList.remove("d-none"); 
    document.getElementById("approveBtn").classList.add("d-none");  
    document.getElementById("rejectBtn").classList.add("d-none"); 
    document.getElementById("closeBtn").classList.add("d-none");  

   
    let footer = document.querySelector(".card-footer");
    let confirmBtn = document.createElement("button");
    confirmBtn.id = "confirmRejectBtn";
    confirmBtn.className = "btn btn-danger mr-2";
    confirmBtn.innerHTML = '<i class="mdi mdi-close"></i> Confirm Reject';

    let cancelBtn = document.createElement("button");
    cancelBtn.id = "cancelRejectBtn";
    cancelBtn.className = "btn btn-secondary";
    cancelBtn.innerText = "Cancel";

    footer.appendChild(confirmBtn);
    footer.appendChild(cancelBtn);

    
    cancelBtn.addEventListener("click", function () {
        document.getElementById("rejectRemarks").classList.add("d-none");
        document.getElementById("approveBtn").classList.remove("d-none"); 
        document.getElementById("rejectBtn").classList.remove("d-none"); 
        document.getElementById("closeBtn").classList.remove("d-none"); 
        confirmBtn.remove();
        cancelBtn.remove();
    });

    
    confirmBtn.addEventListener("click", function () {
        let remarks = document.getElementById("remarks").value.trim();
        if (!remarks) {
            alert("Please enter rejection remarks!");
            return;
        }
        
        alert("Record rejected with remarks: " + remarks); 
        document.getElementById("closeBtn").click(); 
    });
});


document.getElementById("closeBtn").addEventListener("click", function () {
    document.getElementById("rejectRemarks").classList.add("d-none"); 
    document.getElementById("remarks").value = ""; 
    let confirmBtn = document.getElementById("confirmRejectBtn");
    let cancelBtn = document.getElementById("cancelRejectBtn");
    if (confirmBtn) confirmBtn.remove();
    if (cancelBtn) cancelBtn.remove();
    document.getElementById("approveBtn").classList.remove("d-none");
    document.getElementById("rejectBtn").classList.remove("d-none");
    document.getElementById("closeBtn").classList.remove("d-none");
});

    </script>
   

    <script>
    document.addEventListener("DOMContentLoaded", async () => {

    let unverifiedRecords = await api.getAllUnverifiedRecords();
    let list = document.querySelector("#records");
    let recordBookDropdown = document.querySelector("#recordBookDropdown");
    let userDropdown = document.querySelector("#userDropdown");
    let recordBooks = new Set();
    let users = new Set();
    
    let searchBar=document.getElementById('search');

    searchBar.addEventListener('input', () => {
    let filteredRecords = unverifiedRecords.filter((record) =>  
        record.recordName.toLowerCase().includes(searchBar.value.toLowerCase()) ||
        record.recordID.toString().includes(searchBar.value) ||
        record.fullname.toLowerCase().includes(searchBar.value.toLowerCase()) ||
        new Date(record.createdAt).toISOString().replace("T", " ").substring(0, 19).includes(searchBar.value)
    );

    populateRecords(filteredRecords);
});


    let backupRecords = [...unverifiedRecords];

    document.querySelector('#sortByDesc').addEventListener('click', () => {
        unverifiedRecords.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
        populateRecords(unverifiedRecords);
    });
    

    document.querySelector('#sortByAsc').addEventListener('click', () => {
        unverifiedRecords.sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt));
        populateRecords(unverifiedRecords);
    });

   

    function populateRecords(records) {
        list.innerHTML = "";

        records.forEach((record) => {
            recordBooks.add(record.recordName);
            users.add(record.fullname);

            let item = document.createElement("li");
            item.innerHTML = `
                <div class="row mb-1">
                    <div class="col-md-12 stretch-card">
                        <div class="card shadow-lg rounded-lg p-2">
                            <div class="card-body p-2"> 
                                <p class="text-muted mb-1">Record No: ${record.recordID}</p>
                                <h6 class="mb-1">${record.recordName}</h6>
                                <p class="text-muted mb-1">${new Date(record.createdAt).toISOString().replace("T", " ").substring(0, 19)}</p>
                                <p class="text-muted mb-1">${record.fullname}</p>
                                
                                <div class="rejectSection d-none">
                                  <textarea class="form-control rejectRemarks" placeholder="Enter rejection remarks" rows="3"></textarea>
                                  <div class="mt-2 d-flex justify-content-end">
                                      <button class="btn btn-danger btn-sm mx-1 confirmRejectBtn"><i class="mdi mdi-check"></i> Confirm Reject</button>
                                      <button class="btn btn-secondary btn-sm mx-1 cancelRejectBtn"><i class="mdi mdi-close"></i> Cancel</button>
                                  </div>
                                </div>

                                <div class="mt-2 d-flex justify-content-end">
                                    <button class="btn btn-success btn-sm mx-1 approveBtn" data-record='${JSON.stringify(record).replace(/"/g, "&quot;")}'><i class="mdi mdi-check"></i> Approve</button>
                                    <button class="btn btn-danger btn-sm mx-1 rejectBtn"><i class="mdi mdi-close"></i> Reject</button>
                                    <button class="btn btn-primary btn-sm mx-1 viewBtn" data-toggle="modal" data-record='${JSON.stringify(record).replace(/"/g, "&quot;")}' data-target="#fuelOilModal"><i class="mdi mdi-eye"></i> View</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            list.appendChild(item);

            let rejectBtn = item.querySelector(".rejectBtn");
            let approveBtn = item.querySelector(".approveBtn");
            let viewBtn = item.querySelector(".viewBtn");
            let rejectSection = item.querySelector(".rejectSection");
            let confirmRejectBtn = item.querySelector(".confirmRejectBtn");
            let cancelRejectBtn = item.querySelector(".cancelRejectBtn");
            let rejectRemarks = item.querySelector(".rejectRemarks");

            rejectBtn.addEventListener("click", function () {
                rejectSection.classList.remove("d-none");
                rejectRemarks.focus();
                approveBtn.classList.add("d-none");
                rejectBtn.classList.add("d-none");  
                viewBtn.classList.add("d-none");
            });

            const recordbooks={
                
                "Garbage Record Book":"grb",
                "Fuel Oil Sample Record Book":"fos",
                "NOX Tier Change Over Record Book":"nox",
                "Fuel Oil Received Record Book":"for"
            };


            confirmRejectBtn.addEventListener("click", async function () {

                let remarks = rejectRemarks.value.trim();
                if (remarks === "") {
                    alert("Please enter rejection remarks!");
                    return;
                }
                console.log(`Record ${record.recordID} rejected with remarks: ${remarks}`);

                let data={};
                data.recordId=record.recordID;
                data.operation=2;
                data.remarks=remarks;


              let response=await axiosInstance.post(`/${recordbooks[record.recordName]}/verify`,data);                
              console.log(response.data);

                item.remove();
            });

            approveBtn.addEventListener('click',async ()=>{
              
              let data={};
              data.recordId=record.recordID;
              data.operation=1;

              // console.log(data);
              
              let response=await axiosInstance.post(`/${recordbooks[record.recordName]}/verify`,data);
              console.log(response);

              item.remove();
            });

            cancelRejectBtn.addEventListener("click", function () {
                rejectSection.classList.add("d-none");
                approveBtn.classList.remove("d-none");
                rejectBtn.classList.remove("d-none");
                viewBtn.classList.remove("d-none");
                rejectRemarks.value = "";
            });
        });
    }

    function populateDropdown() {
        recordBookDropdown.innerHTML = "";
        userDropdown.innerHTML = "";

        users.forEach((user) => {
            let li = document.createElement("li");
            li.className = "dropdown-item text-white";
            li.style.cursor = "pointer";
            li.textContent = user;
            userDropdown.appendChild(li);

            li.addEventListener("click", function () {
                let selectedUser = user;
                let filteredRecords = unverifiedRecords.filter((record) => record.fullname === selectedUser);
                populateRecords(filteredRecords);
            });
        });

        let li = document.createElement("li");
            li.className = "dropdown-item text-white";
            li.style.cursor = "pointer";
            li.textContent = 'Show all';

            li.addEventListener("click", function () {  
                populateRecords(unverifiedRecords);
            });

            recordBookDropdown.appendChild(li);

        let li2 = document.createElement("li");
            li2.className = "dropdown-item text-white";
            li2.style.cursor = "pointer";
            li2.textContent = 'Show All';

            li2.addEventListener("click", function () {  
                populateRecords(unverifiedRecords);
            });

            userDropdown.appendChild(li2);

        recordBooks.forEach((recordBook) => {
            let li = document.createElement("li");
            li.className = "dropdown-item text-white";
            li.style.cursor = "pointer";
            li.textContent = recordBook;
            recordBookDropdown.appendChild(li);

          li.addEventListener("click", function () {
            let selectedRecordBook = recordBook;
            let filteredRecords = unverifiedRecords.filter((record) => record.recordName === selectedRecordBook);
            populateRecords(filteredRecords);
          });

        });
    }

    populateRecords(unverifiedRecords);
    populateDropdown();
});

   document.getElementById('records').addEventListener('click', function(event) {
  
    let modalTable = document.getElementById('recordModal');
    let tbody=modalTable.querySelector('tbody');
    tbody.innerHTML='';

    // let modal = new bootstrap.Modal(document.getElementById('recordModal'));
    // modal.show();
    
    let btn = event.target.closest('.viewBtn');
    if (btn) {
      try {
    let record = JSON.parse(btn.dataset.record);
    
    let modalLabel=document.querySelector('#fuelOilModalLabel');
    modalLabel.textContent=record.recordName+" - Record No: "+record.recordID;
    
    delete record.verifiedBy;
    delete record.verificationStatus;
    delete record.approvalStatus;
    delete record.approvedBy;
    delete record.ceSigned;
    delete record.deSigned;
    delete record.deSignedAt;
    delete record.ceSignedAt;
    delete record.verificationRemarks;

    
    const formatDate = (dateStr) => {
        if (!dateStr) return "N/A";
        const date = new Date(dateStr);
        return date.toLocaleString('en-GB', { 
            day: '2-digit', month: 'short', year: 'numeric', 
            hour: '2-digit', minute: '2-digit', second: '2-digit' 
        });
    };

    for (let key in record) {
        let row = document.createElement('tr');

        let cell = document.createElement('td');
        cell.textContent = key === 'createdBy' ? 'User ID' : 
            key.replace(/([a-z])([A-Z])/g, '$1 $2') 
               .replace(/\b\w/g, char => char.toUpperCase()); 
        row.appendChild(cell);

        cell = document.createElement('td');
        if (['createdAt', 'date', 'time','dateSampleDestroyed'].includes(key)) {
            cell.textContent = formatDate(record[key]);
        } else {
            cell.textContent = record[key];
        }
        row.appendChild(cell);

        tbody.appendChild(row);
    }
    console.log(record);
} catch (error) {
    console.error('Invalid JSON:', btn.dataset.record);
}

    }
});


    </script>
    <script>
            let token=sessionStorage.getItem('token');
          
          if(!sessionStorage.getItem('token')){
            window.location='login.html';
          }

          if (token) {
            const base64Url = token.split(".")[1]; 
            const base64 = base64Url.replace(/-/g, "+").replace(/_/g, "/");
            const decodedData = JSON.parse(atob(base64));
            // document.querySelector('#username').textContent=decodedData.username;
            // console.log(decodedData);

            if(decodedData.user.role_id!==2){
              window.location='index.html';
            }
        }
    </script>
  </body>
</html>